# 算法层技术实现文档

该文档介绍算法层的实现。

## 技术栈

该部分主要涉及论文库的解析与 ChromaDB 的使用。

## 用户分割

对于不同用户之间的论文相互隔离，不同用户使用不同的 collection 来存储论文。查询时限定在该用户的 collection 中进行。

## 论文解析

对于每一个 PDF 文件，使用 PyPDF 读取 PDF 文件，提取文本。提取文本后，根据固定长度的字符串进行分割，以灵活查询论文的不同片段，也规避了 ChromaDB 的 token 限制。在读取后，根据文件的 sha256 码和第几个片段创建一个唯一 id，另外将原来的文件 ID 作为标签，以便后续分类查询与删除。

## 关键词检索

实际上是在 ChromaDB 中进行的检索。注意，制作了一些精细化处理，例如：检索到的两个最匹配片段分别位于论文 A 的第 10 段和论文 B 的第 10 段。他会自动将前后的段落（+-1）也查询出来，考虑到文本的连贯性。

另外，对于一些情况做了合并，例如查询到的片段是 A 的 10 和 12 段，则理论上需要以下片段

```
9 10 11
11 12 13
```

系统会自动合并相邻的片段，输出会类似于

```
chunk 9 - 13: 9-13段的内容
```

## 多关键词检索

检索多次，然后一齐合并。

# 算法层代码

较为简单，都放在 `main.py` 中了。包括上述的功能，以及 pydantic 的请求体。
